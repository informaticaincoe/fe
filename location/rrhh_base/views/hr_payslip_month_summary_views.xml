<odoo>
    <data>
        <!-- Búsqueda con panel Año/Mes y agrupación por Empleado -->
        <record id="view_hr_payslip_monthly_summary_search" model="ir.ui.view">
            <field name="name">hr.payslip.monthly.summary.search</field>
            <field name="model">hr.payslip.monthly.summary</field>
            <field name="arch" type="xml">
                <search string="Resumen mensual de Nómina">
                    <group expand="0" string="Agrupar por">
                        <filter name="group_by_company" string="Empresa" context="{'group_by':'company_id'}"/>
                        <filter name="group_by_year" string="Año" context="{'group_by':'period_year'}"/>
                        <filter name="group_by_month" string="Mes" context="{'group_by':'period_month'}"/>
                        <filter name="group_by_employee" string="Empleado" context="{'group_by':'employee_id'}"/>
                        <filter name="group_by_department" string="Departamento"
                                context="{'group_by':'department_id'}"/>
                    </group>
                    <searchpanel>
                        <field name="company_id" string="EMPRESA" select="multi" enable_counters="1"/>
                        <field name="period_year" string="AÑO" select="one" enable_counters="1"/>
                        <field name="period_month" string="MES" select="one" enable_counters="1"/>
                        <field name="department_id" string="DEPARTAMENTO" select="multi" enable_counters="1"/>
                    </searchpanel>
                    <filter name="mes_actual" string="Mes actual"
                            domain="[('period_year','=', time.strftime('%%Y')), ('period_month','=', time.strftime('%%m'))]"/>
                </search>
            </field>
        </record>

        <!-- Lista resumida (una fila = empleado + año + mes) -->
        <record id="view_hr_payslip_monthly_summary_tree" model="ir.ui.view">
            <field name="name">hr.payslip.monthly.summary.tree</field>
            <field name="model">hr.payslip.monthly.summary</field>
            <field name="arch" type="xml">
                <list string="Resumen mensual de nómina" create="false" edit="false" delete="false">
                    <field name="employee_id"/>
                    <field name="department_id"/>

                    <field name="total_worked_days"/>
                    <field name="total_worked_hours"/>

                    <field name="salario_pagar"/>
                    <field name="total_comisiones"/>
                    <field name="total_overtime"/>

                    <field name="viaticos"/>
                    <field name="total_viaticos_a_pagar"/>

                    <field name="total_devengado"/>

                    <field name="isss"/>
                    <field name="isr"/>
                    <field name="afp"/>
                    <field name="afp_confia"/>
                    <field name="otros"/>
                    <field name="bancos"/>
                    <field name="venta_empleados"/>
                    <field name="prestamos_incoe"/>
                    <field name="fsv"/>

                    <field name="total_descuentos"/>
                    <field name="sueldo_liquido"/>
                </list>
            </field>
        </record>

        <!-- Acción -->
        <record id="action_hr_payslip_monthly_summary" model="ir.actions.act_window">
            <field name="name">Resumen Mensual (Suma Quincenas)</field>
            <field name="res_model">hr.payslip.monthly.summary</field>
            <field name="view_mode">list</field>
            <field name="search_view_id" ref="view_hr_payslip_monthly_summary_search"/>
            <!-- activar ambos group_by por defecto -->
            <field name="context">
                {
                'search_default_group_by_company': 1,
                'search_default_group_by_year': 1,
                'search_default_group_by_month': 1
                }
            </field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    Reporte de nómina mensual por empleado (suma 1ª y 2ª quincena, incluyendo vacaciones).
                </p>
            </field>
        </record>

        <record id="hr_payslip_monthly_summary_company_rule" model="ir.rule">
            <field name="name">Monthly Summary: multi-company</field>
            <field name="model_id" ref="model_hr_payslip_monthly_summary"/>
            <field name="domain_force">[('company_id','in', company_ids)]</field>
            <field name="groups" eval="[(4, ref('base.group_user'))]"/>
        </record>

        <!-- Menú: Recursos Humanos > Nómina > Reportes > Resumen Mensual -->
        <menuitem id="menu_hr_payslip_monthly_summary_root"
                  name="Resumen Mensual"
                  parent="submenu_hr_reportes"
                  action="action_hr_payslip_monthly_summary"
                  sequence="20"
                  groups="base.group_system"/>
    </data>
</odoo>
