<odoo>
    <data>
        <!-- Vista tipo lista -->
        <record id="view_hr_salary_assignment_tree" model="ir.ui.view">
            <field name="name">hr.salary.assignment.tree</field>
            <field name="model">hr.salary.assignment</field>
            <field name="arch" type="xml">
                <list>
                    <header>
                        <button name="action_descargar_plantilla" type="object" icon="fa-download" string="Plantilla"
                                display="always"/>
                    </header>
                    <field name="employee_id" widget="many2one_avatar_employee"/>
                    <field name="tipo" widget="badge" class="tipo_badge"/>
                    <field name="monto"/>
                    <field name="periodo"/>
                    <field name="description"/>
                    <field name="payslip_id"/>
                </list>
            </field>
        </record>

        <!-- Vista tipo formulario -->
        <record id="view_hr_salary_assignment_form" model="ir.ui.view">
            <field name="name">hr.salary.assignment.form</field>
            <field name="model">hr.salary.assignment</field>
            <field name="arch" type="xml">
                <form>
                    <sheet>
                        <group>
                            <group>
                                <field name="employee_id" widget="many2one_avatar_employee"/>
                                <field name="tipo"/>
                                <field name="description"/>
                            </group>
                            <group>
                                <field name="monto"
                                       invisible="(tipo == 'OVERTIME') or (tipo == 'VIATICO' and mostrar_horas_extras)"/>
                                <field name="periodo"/>
                            </group>
                            <field name="codigo_empleado" invisible="1"/>
                            <group>
                                <field name="mostrar_horas_extras" string="Agregar como horas extras" widget="boolean"
                                       invisible="tipo != 'VIATICO'"/>
                            </group>
                        </group>
                        <group string="Detalle de horas extras"
                               invisible="not ((tipo == 'OVERTIME') or (tipo == 'VIATICO' and mostrar_horas_extras))">
                            <field name="horas_extras_ids">
                                <list editable="bottom">
                                    <field name="horas_diurnas"/>
                                    <field name="horas_nocturnas"/>
                                    <field name="horas_diurnas_descanso"/>
                                    <field name="horas_nocturnas_descanso"/>
                                    <field name="horas_diurnas_asueto"/>
                                    <field name="horas_nocturnas_asueto"/>
                                    <field name="descripcion"/>
                                </list>
                            </field>
                        </group>
                    </sheet>
                </form>
            </field>
        </record>

        <!-- Vista de búsqueda para el modelo hr.salary.assignment -->
        <record id="view_hr_salary_assignment_search" model="ir.ui.view">
            <field name="name">hr.salary.assignment.search</field>
            <field name="model">hr.salary.assignment</field>
            <field name="arch" type="xml">
                <search string="Buscar Asignaciones Salariales">
                    <!-- Campo de búsqueda por nombre del empleado -->
                    <field name="employee_id" filter_domain="[('employee_id.name', 'ilike', self)]"/>

                    <!-- Botón para agrupar por fecha. Asumiendo que tienes un campo de fecha. -->
                    <group expand="0" string="Agrupar Por">
                        <filter name="group_by_employee_name" string="Empleado"
                                context="{'group_by': 'employee_name'}"/>
                        <filter name="group_by_periodo_day" string="Fecha Completa"
                                context="{'group_by': 'periodo:day'}"/>
                    </group>

                    <searchpanel>
                        <field name="period_year" string="AÑO" select="one" enable_counters="1"/>
                        <field name="period_month" string="MES" select="one" enable_counters="1"/>
                        <field name="period_quincena" string="QUINCENA" select="one" enable_counters="1"/>
                    </searchpanel>

                    <filter name="mes_actual"
                            string="Mes actual"
                            domain="[('period_year','=', time.strftime('%%Y')), ('period_month','=', time.strftime('%%m'))]"/>
                    <filter name="q1_mes_actual"
                            string="1ª quincena (mes actual)"
                            domain="[('period_year','=', time.strftime('%%Y')),
                               ('period_month','=', time.strftime('%%m')),
                               ('period_quincena','=','1')]"/>
                    <filter name="q2_mes_actual"
                            string="2ª quincena (mes actual)"
                            domain="[('period_year','=', time.strftime('%%Y')),
                               ('period_month','=', time.strftime('%%m')),
                               ('period_quincena','=','2')]"/>
                </search>
            </field>
        </record>

        <record id="action_asignaciones" model="ir.actions.act_window">
            <field name="name">Asignaciones Salariales</field>
            <field name="res_model">hr.salary.assignment</field>
            <field name="view_mode">list,form</field>
            <!-- Enlaza la vista de búsqueda con la acción -->
            <field name="search_view_id" ref="view_hr_salary_assignment_search"/>
            <field name="context">{'group_by': 'periodo:day'}</field>
        </record>

        <record id="action_asignaciones" model="ir.actions.act_window">
            <field name="name">Asignaciones Salariales</field>
            <field name="res_model">hr.salary.assignment</field>
            <field name="view_mode">list,form</field>
            <field name="search_view_id" ref="view_hr_salary_assignment_search"/>
            <field name="context">{'group_by': 'periodo:day'}</field>
            <!-- opcional: puedes dejar [] o no poner domain -->
            <field name="domain">[]</field>
        </record>

        <!-- Regla multiempresa usando company_ids (empresas chequeadas) -->
        <record id="hr_salary_assignment_company_rule" model="ir.rule">
            <field name="name">Salary Assignment multi-company</field>
            <field name="model_id" ref="model_hr_salary_assignment"/>
            <!-- Si quieres incluir registros sin company_id, deja la línea con el OR -->
            <field name="domain_force">
                ['|', ('company_id','=', False), ('company_id','in', company_ids)]
            </field>
            <field name="groups" eval="[(4, ref('base.group_user'))]"/>
        </record>

    </data>

</odoo>
