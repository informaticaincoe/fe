<?xml version="1.0" encoding="UTF-8"?>
<odoo>
  <data>

    <!-- 1) Vista FORM específica para exp_duca (la usaremos embebida) -->
    <record id="exp_duca_inline_form" model="ir.ui.view">
      <field name="name">exp.duca.inline.form</field>
      <field name="model">exp_duca</field>
      <field name="arch" type="xml">
        <form string="DUCA">
          <sheet>
            <group>
              <group>
                <field name="company_id" readonly="1"/>
                <field name="number"/>
                <field name="acceptance_date"/>
                <field name="regimen"/>
                <field name="aduana"/>
                <field name="currency_id"/>
              </group>
              <group string="Valores">
                <field name="valor_en_aduana"/>
                <field name="dai_amount"/>
                <field name="iva_importacion"/>
              </group>
            </group>
            <group string="Documento">
              <field name="duca_file" filename="duca_filename"/>
              <field name="duca_filename"/>
            </group>
          </sheet>
        </form>
      </field>
    </record>

    <!-- 2) Pestaña DUCA en account.move, forzando one2many a FORM (sin kanban/list) -->
    <record id="view_move_form_exp_duca_tab" model="ir.ui.view">
      <field name="name">account.move.form.exp_duca.tab</field>
      <field name="model">account.move</field>
      <field name="inherit_id" ref="account.view_move_form"/>
      <field name="arch" type="xml">
        <xpath expr="//sheet/notebook" position="inside">
          <page name="exp_duca_page"
                string="DUCA"
                invisible="codigo_tipo_documento_id != '11' or move_type not in ['in_invoice','in_refund']">
            <field name="exp_duca_id"
                   widget="one2many"
                   nolabel="1"
                   context="{'default_move_id': id, 'default_company_id': company_id}"
                   views="{'form': 'purchase_sv.exp_duca_inline_form'}"
                   options="{'no_open': True, 'no_create_edit': True}"/>
          </page>
        </xpath>
      </field>
    </record>

  </data>
</odoo>
